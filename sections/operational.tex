% !TeX root = ../main-presentation.tex
\section{Operational semantics}

\begin{frame}
    \frametitle{Doing something useful}

    \centering

    \LARGE
    Suppose we have two circuits \\
    with the same denotation
    \normalsize

    \vspace{2em}

    \(
        \llbracket\dsptikzfig{strings/category/f}[box=F,colour=seq]\rrbracket
        =
        \llbracket\dsptikzfig{strings/category/f}[box=G,colour=seq]\rrbracket
    \)

    \vspace{2em}

    \LARGE
    \pause
    What does this tell us about the \\
    \alert{structure} of these circuits?

\end{frame}

\begin{frame}
    \frametitle{Reducing it down}

    \pause

    \centering
    \scalebox{4}{\textbf{Operational}}

    \scalebox{4}{\textbf{semantics}}

\end{frame}
\begin{frame}
    \frametitle{Reducing it down}

    \centering
    \LARGE

    We want to find a set of \\ \alert{reductions} for digital circuits


    \pause
    We want to reduce circuits to their outputs \alert{syntactically}
    in a \alert{step-by-step} manner

\end{frame}
\begin{frame}
    \frametitle{Going global}

    \centering

    \dsptikzfig{strings/category/f}[box=F,colour=seq]
    \Large=\normalsize
    \dsptikzfig{circuits/productivity/trace-delay}[core=\hat{F},state=\listvar{v}]

    \vspace{1em}
    \Large
    by moving boxes and wires around
\end{frame}

\begin{frame}
    \frametitle{Going global}

    \centering
    \Large

    \pause

    \normalsize
    \begin{gather*}
        \dsptikzfig{circuits/components/waveforms/register}
        \coloneqq
        \dsptikzfig{circuits/components/waveforms/register-shorthand}
        \qquad
        \Large
        \text{\alert{`Register'}}
    \end{gather*}

    \vspace{1em}

    \pause

    \dsptikzfig{circuits/productivity/trace-delay}[core=F,state=\listvar{v}]
    \Large\(\reduction\)\normalsize
    \dsptikzfig{circuits/productivity/mealy-rule}

\end{frame}
\begin{frame}
    \frametitle{Going global}

    \centering

    \dsptikzfig{strings/category/f}[box=F,colour=seq]
    \Large\(\reductions\)\normalsize
    \dsptikzfig{circuits/productivity/pre-mealy-form}[core=\hat{F},state=\listvar{s}]

    \pause
    \vspace{1em}

    \Large
    What are we going to do about the non-delay-guarded trace?

\end{frame}
\begin{frame}
    \frametitle{Do we even need it?}

    \centering

    \LARGE

    In industry, feedback is usually \alert{delay-guarded}.

    \pause

    But this rules out some \alert{clever} circuits!

    \normalsize

    \vspace{1em}

    \scalebox{0.75}{
        \dsptikzfig{circuits/examples/cyclic-combinational/circuit-scirc}
        \(\Rightarrow\)
        \dsptikzfig{circuits/examples/cyclic-combinational/reduced-true}
    }

    \pause

    \vspace{1em}

    \scriptsize
    (And also it would be cheating)

\end{frame}
\begin{frame}
    \frametitle{Getting rid of non-delay-guarded feedback}

    \centering
    \LARGE

    \(\values\) is a \alert{finite} lattice...\

    \pause
    The functions are monotone...

    \pause
    We can compute the \alert{least fixed point} in finite iterations!

\end{frame}
\begin{frame}
    \frametitle{Getting rid of non-delay-guarded feedback}

    \centering
    \[
        \dsptikzfig{circuits/instant-feedback/f0-box}
        \coloneqq
        \dsptikzfig{circuits/instant-feedback/f0-definition}
        \pause
        \qquad
        \dsptikzfig{circuits/instant-feedback/fkp1-box}
        \coloneqq
        \dsptikzfig{circuits/instant-feedback/fkp1-definition}
    \]
    \pause
    \[
        \dsptikzfig{circuits/instant-feedback/equation-lhs}[box=F,trace=x]
        \quad
        \reduction
        \quad
        \dsptikzfig{circuits/instant-feedback/fixpoint-concrete}
    \]

\end{frame}
\begin{frame}
    \frametitle{Getting rid of non-delay-guarded feedback}


    \[
        \dsptikzfig{circuits/instant-feedback/trand}
        \quad
        \pause
        \reduction
        \quad
        \dsptikzfig{circuits/instant-feedback/trand-instfb}
    \]


\end{frame}
\begin{frame}
    \frametitle{Here's Mealy}

    \centering
    \Large
    For \alert{any} circuit
    \normalsize

    \[
        \dsptikzfig{strings/category/f}[box=F,colour=seq]
        \quad
        \reductions
        \quad
        \dsptikzfig{circuits/productivity/mealy-form}[core=\tilde{F},state=\overline{s}]
    \]

\end{frame}
\begin{frame}
    \frametitle{What is the goal}

    \centering

    \pause
    \Large
    We want to compute the \alert{outputs} of circuits given some \alert{inputs}
    \normalsize

    \begin{gather*}
        \dsptikzfig{circuits/productivity/productive-goal-lhs}[box=F]
        \reductions
        \dsptikzfig{circuits/productivity/productive-goal-rhs}[box=G]
    \end{gather*}

    \pause

    \vspace{1em}

    \Large

    How does a circuit \alert{process} a value?

\end{frame}
\begin{frame}
    \frametitle{Reducing values}

    \begin{gather*}
        \dsptikzfig{circuits/axioms/gate-lhs}
        \reduction
        \dsptikzfig{circuits/axioms/gate-rhs}
        \qquad
        \dsptikzfig{circuits/axioms/fork-lhs}
        \reduction
        \dsptikzfig{circuits/axioms/fork-rhs}
        \\[0.5em]
        \dsptikzfig{circuits/axioms/join-lhs}
        \reduction
        \dsptikzfig{circuits/axioms/join-rhs}
        \qquad
        \dsptikzfig{circuits/axioms/stub-lhs}
        \reduction
        \dsptikzfig{strings/monoidal/empty}
    \end{gather*}

    \vspace{1em}
    \Large

    \begin{lemma}
        For every
        \dsptikzfig{strings/category/f}[box=F,colour=comb]
        there exists
        \dsptikzfig{circuits/components/values/vs}[val=\listvar{w}]
        s.t.
        \dsptikzfig{circuits/components/circuits/f-applied}[box=F,colour=comb]
        \(\reduction\)
        \dsptikzfig{circuits/components/values/vs}[val=\listvar{w}].
    \end{lemma}

\end{frame}


\begin{frame}
    \frametitle{Catching the jet stream}

    \Large

    What about \alert{delays}?

    \normalsize

    \begin{gather*}
        \visible<2->{\dsptikzfig{circuits/axioms/generalised-streaming-lhs}[box=F]}
        \visible<3->{\coloneqq}
        \visible<3->{\dsptikzfig{circuits/axioms/generalised-streaming-lhs-verbose}[box=F]}
        \visible<4->{\reduction}
        \visible<4->{\dsptikzfig{circuits/axioms/generalised-streaming-rhs}[box=F]}
        \qquad
        \visible<5->{\text{\alert{'Streaming'}}}
    \end{gather*}
\end{frame}

\begin{frame}
    \frametitle{Catching the jet stream}

    \vspace{-2em}

    \begin{gather*}
        \visible<2->{\dsptikzfig{circuits/productivity/productive-goal-lhs}[box=F]}
        \visible<3->{\reduction}
        \visible<3->{\dsptikzfig{circuits/productivity/mealy-form-applied}[core=\hat{F}]}
        \visible<4->{\reduction}
        \visible<4->{\dsptikzfig{circuits/productivity/mealy-form-streamed}[core=\hat{F}]}
        \\[0.5em]
        \visible<5->{\reduction}
        \visible<5->{\dsptikzfig{circuits/productivity/mealy-form-instant}[core=\hat{F}]}
        \visible<6->{\reduction}
        \visible<6->{\dsptikzfig{circuits/productivity/mealy-form-instant-registers}[core=\hat{F}]}
        \\[0.5em]
        \visible<7->{\reduction}
        \visible<7->{\dsptikzfig{circuits/productivity/mealy-form-produced}[core=\hat{F}]}
        \visible<8->{\coloneqq}
        \visible<8->{\dsptikzfig{circuits/productivity/productive-goal-rhs}[box=G]}
    \end{gather*}
\end{frame}

\begin{frame}
    \frametitle{Observe this}

    \centering
    \LARGE

    When are two circuits \alert{observationally equivalent}?

    \pause

    Circuits have \alert{finitely many states}...

    \pause
    \Large
    \begin{definition}
        Two circuits with at most \(c\) delay components are observationally
        equivalent if the reduction procedure creates the same outputs for all
        inputs of length \(|\values|^c+1\).
    \end{definition}

\end{frame}

\begin{frame}
    \frametitle{Observe this}

    \Large

    \begin{theorem}
        Two circuits are observationally equivalent if and only if they are
        denotationally equivalent.
    \end{theorem}

\end{frame}